<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 如何手动实现一个 UIScrollView · 孙金帅的技术博客</title><meta name="description" content="如何手动实现一个 UIScrollView - sunjinshuai"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://sunjinshuai.github.io/atom.xml" title="孙金帅的技术博客"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="孙金帅的技术博客" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://weibo.com/u/5113807465" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/sunjinshuai" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">如何手动实现一个 UIScrollView</h1><div class="post-info">2016年4月15日</div><div class="post-content"><p><code>UIKit</code> 坐标系每一个 <code>View</code> 都定义了他自己的坐标系，如下图所示，<code>x</code> 轴指向右方，<code>y</code> 轴指向下方：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/588630-b4be73e8ede40f16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>注意：<br>这个逻辑坐标系并不关注包含在其中 <code>View</code> 的宽度和高度，整个坐标系没有边界向四周无限延伸。<br>我们在坐标系中放置四个子 <code>View</code>，每一次色块代表一个 <code>View</code>：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/588630-173b57f84345e191.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">UIView *redView &#x3D; [[UIView alloc] initWithFrame:CGRectMake(20, 20, 100, 100)];</span><br><span class="line">redView.backgroundColor &#x3D; [UIColor colorWithRed:0.815 green:0.007</span><br><span class="line">blue:0.105 alpha:1];</span><br><span class="line"></span><br><span class="line">UIView *greenView &#x3D; [[UIView alloc] initWithFrame:CGRectMake(150, 160, 150, 200)];</span><br><span class="line">greenView.backgroundColor &#x3D; [UIColor colorWithRed:0.494 green:0.827</span><br><span class="line">blue:0.129 alpha:1];</span><br><span class="line"></span><br><span class="line">UIView *blueView &#x3D; [[UIView alloc] initWithFrame:CGRectMake(40, 400, 200, 150)];</span><br><span class="line">blueView.backgroundColor &#x3D; [UIColor colorWithRed:0.29 green:0.564</span><br><span class="line">blue:0.886 alpha:1];</span><br><span class="line"></span><br><span class="line">UIView *yellowView &#x3D; [[UIView alloc] initWithFrame:CGRectMake(100, 600, 180, 150)];</span><br><span class="line">yellowView.backgroundColor &#x3D; [UIColor colorWithRed:0.972 green:0.905</span><br><span class="line">blue:0.109 alpha:1];</span><br><span class="line"></span><br><span class="line">[mainView addSubview:redView];</span><br><span class="line">[mainView addSubview:greenView];</span><br><span class="line">[mainView addSubview:blueView];</span><br><span class="line">[mainView addSubview:yellowView];</span><br></pre></td></tr></table></figure>

<h4 id="bounds"><a href="#bounds" class="headerlink" title="bounds"></a>bounds</h4><p><code>Apple</code> 关于 <code>UIView</code> 的文档中是这样描述 <code>bounds</code> 属性的：</p>
<blockquote>
<p>bounds矩形…描述了该视图在其自身坐标系中的位置和大小。</p>
</blockquote>
<p>一个 <code>View</code> 可以被看作是定义在其所在坐标系平面上的一个矩形的可视区域，<code>View</code> 的边界表明了这个矩形可视区域的位置和大小。</p>
<p>假设我们的 <code>View</code> 宽320像素，高480像素，原点在（0，0）。那么这个 <code>View</code> 就变成了整个坐标系平面的观察口，它展示的只是整个平面的一小部分。位于该 <code>View</code> 边界外的区域依然存在，只是被隐藏起来了。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/588630-ce142480ad4ae548.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>一个 <code>View</code> 提供了其所在平面的一个观察口，<code>View</code> 的 <code>bounds</code> 矩形描述了这个可是区域的位置和大小。</p>
<p>接下来我们来试着修改 <code>bounds</code> 的原点坐标：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CGRect bounds &#x3D; mainView.bounds;</span><br><span class="line">bounds.origin &#x3D; CGPointMake(0, 100);</span><br><span class="line">mainView.bounds &#x3D; bounds;</span><br></pre></td></tr></table></figure>

<p>当我们把 <code>bound</code> 原点设为（0，100）后，整个画面看起来就像这样：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/588630-615c7c579a14e6f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>修改 <code>bounds</code> 的原点就相当与在平面上移动这个可视区域。</p>
<p>看起来好像是这个 <code>View</code> 向下移动了100像素，在这个 <code>View</code> 自己的坐标系中这确实没错。不过这个 <code>View</code> 真正位于屏幕上的位置（更准确的说在其父 <code>View</code> 上的位置）其实没有改变，因为这是由 <code>View</code> 的 <code>frame</code> 属性决定的，它并没有改变：</p>
<blockquote>
<p>frame矩形…定义了这个View在其父View坐标系中的位置和大小。</p>
</blockquote>
<p>由于 <code>View</code> 的位置是相对固定的，你可以把整个坐标平面想象成我们可以上下拖动的透明幕布，把这个 <code>View</code> 想象成我们观察坐标平面的窗口。调整 <code>View</code> 的 <code>Bounds</code> 属性就相当于拖动这个幕布，那么下方的内容就能在我们 <code>View</code> 中被观察到：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/588630-660f880bec22bb97.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>修改 <code>bounds</code> 的原点坐标也相当于把整个坐标系向上拖动，因为 <code>View</code> 的 <code>frame</code> 没由变过，所以它相对于父 <code>View</code> 的位置没有变化过。</p>
<p>其实这就是 <code>UIScrollView</code> 滑动时所发生的事情。注意从一个用户的角度来看，他以为时这个 <code>View</code> 中的子 <code>View</code> 在移动，其实他们的在坐标系中位置（他们的 <code>frame</code> ）没有发生过变化。</p>
<p>一个 <code>scroll view</code> 并不需要其中子 <code>View</code> 的坐标来使他们滚动，唯一要做的就是改变他的 <code>bounds</code> 属性。知道了这一点，实现一个简单的 <code>scroll view</code> 就没什么困难了。我们用一个 <code>gesture recognizer</code> 来识别用户的拖动操作，根据用户拖动的偏移量来改变 <code>bounds</code> 的原点：</p>
<p>和真正的 <code>UIScrollView</code> 一样，我们的类也有一个 <code>contentSize</code> 属性，你必须从外部来设置这个值来指定可以滚动的区域，当我们改变 <code>bounds</code> 的大小时我们要确保设置的值是有效的。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/04/17/iOS-RunTime%E4%B9%8BSelf-Super/" class="prev">上一篇</a><a href="/2016/04/10/iOS-%E4%B8%AD-NSString-%E5%B1%9E%E6%80%A7%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E7%94%A8-copy%EF%BC%8C%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E7%94%A8-strong/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'sunjinshuai';
var disqus_identifier = '2016/04/15/如何手动实现一个 UIScrollView/';
var disqus_title = '如何手动实现一个 UIScrollView';
var disqus_url = 'https://sunjinshuai.github.io/2016/04/15/如何手动实现一个 UIScrollView/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//sunjinshuai.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2022 <a href="https://sunjinshuai.github.io">sunjinshuai</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>